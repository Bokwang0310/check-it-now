<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>안종언의 출⭐결 시스템^^</title>
  </head>
  <body>
    <button class="submit-btn">가보자고</button>
    <script>
      if (!localStorage.getItem("board")) {
        localStorage.setItem("board", "");
      }

      const URLSearch = new URLSearchParams(location.search);
      const classRoomID = URLSearch.get("class");

      const submitBtn = document.querySelector(".submit-btn");
      const idInput = document.querySelector(".id-input");

      submitBtn.addEventListener("click", () => {
        const schedule = localStorage.getItem("schedule");

        if (!schedule) {
          const A = prompt("A를 입력");
          const B = prompt("B를 입력");
          const C = prompt("C를 입력");
          const D = prompt("D를 입력");
          const E = prompt("E를 입력");
          const F = prompt("F를 입력");
          const G = prompt("G를 입력");
          const H = prompt("H를 입력");

          localStorage.setItem("schedule", [A, B, C, D, E, F, G, H]);
        }

        const currentDate = new Date();
        const table =
          getSchedule(schedule.split(",")) ||
          localStorage.getItem("schedule").split(",");

        const classNum = checkClass(new Date());
        const day = getDayByNum(currentDate.getDay());

        const subject = table[day][classNum - 1];
        console.log(subject);
        console.log(classRooms[classRoomID].includes(subject));

        const newOne = `${
          currentDate.getMonth() + 1
        }${currentDate.getDate()}-${classNum}교시`;

        const board = localStorage.getItem("board").split(",");
        if (!board.includes(newOne)) board.push(newOne);

        localStorage.setItem("board", board);
      });

      const getDayByNum = (num) => {
        const currentDate = new Date();
        if (currentDate.getDay() === 1) return "mon";
        else if (currentDate.getDay() === 2) return "tue";
        else if (currentDate.getDay() === 3) return "wen";
        else if (currentDate.getDay() === 4) return "thu";
        else return "fri";
      };

      const getSchedule = ([A, B, C, D, E, F, G, H]) => ({
        mon: [C, "class", B, E, "class", D, A],
        tue: [F, D, E, H, "class", A, B],
        wen: ["class", C, "class", "class", "class", "class"],
        thu: ["class", F, E, "class", "class", B, G],
        fri: [G, D, "class", A, H, C, F],
      });

      const makeDates = (date, [hourA, minA], [hourB, minB]) => {
        a = new Date(date);
        a.setHours(hourA);
        a.setMinutes(minA);

        b = new Date(date);
        b.setHours(hourB);
        b.setMinutes(minB);

        return [new Date(a), new Date(b)];
      };

      const getAllClasses = () => {
        const currentDate = new Date();
        const one = makeDates(currentDate, [8, 31], [9, 30]);
        const two = makeDates(currentDate, [9, 31], [10, 30]);
        const three = makeDates(currentDate, [10, 31], [11, 30]);
        const four = makeDates(currentDate, [11, 31], [12, 30]);
        const five = makeDates(currentDate, [13, 31], [14, 30]);
        const six = makeDates(currentDate, [14, 31], [15, 30]);
        const seven = makeDates(currentDate, [15, 31], [16, 30]);

        return [one, two, three, four, five, six, seven];
      };

      const checkClass = (date) => {
        const [one, two, three, four, five, six, seven] = getAllClasses();

        if (one[0] <= date && date <= one[1]) return 1;
        else if (two[0] <= date && date <= two[1]) return 2;
        else if (three[0] <= date && date <= three[1]) return 3;
        else if (four[0] <= date && date <= four[1]) return 4;
        else if (five[0] <= date && date <= five[1]) return 5;
        else if (six[0] <= date && date <= six[1]) return 6;
        else if (seven[0] <= date && date <= seven[1]) return 7;
      };

      const classRooms = {
        one: ["정치와법"],
        two: ["실용경제"],
        three: ["세계사"],
        four: ["경제"],
        five: [],
        six: ["영어독해와작문"],
        seven: ["기하", "언어와매체"],
        eight: ["화법과작문", "심리학"],
        nine: ["미적분"],
        ten: ["확률과통계"],
        creative: ["지구과학2", "물리학2"],
        computer: ["프로그래밍"],
        art: [],
      };
    </script>
  </body>
</html>
